## FTP ###################################################################
filter {
  if [event][dataset] == "ftp" {
    if [ftp] {

      mutate {
        merge => { "[related][id]" => "[log][id][fuid]" }
        rename => {
          "[ftp][reply_code]" => "[ftp][response][code]"
          "[ftp][reply_msg]" => "[ftp][response][message]"
          "[ftp][arg]" => "[ftp][args]"
          "[ftp][cwd]" => "[ftp][path]"
          "[ftp][user]" => "[client][user][name]"
          "[ftp][password]" => "[client][user][password]"
          "[ftp][file_size]" => "[file][size]"
          "[ftp][data_channel_passive]" => "[ftp][data_channel][passive]"
          "[ftp][data_channel_orig_h]" => "[ftp][data_channel][orig][ip]"
          "[ftp][data_channel_resp_h]" => "[ftp][data_channel][resp][ip]"
          "[ftp][data_channel_resp_p]" => "[ftp][data_channel][resp][port]"
        }
      }

      # Add data channel IP's to related if they exist
      if [ftp][data_channel][orig][ip] {
        mutate { merge => { "[related][ip]" => "[ftp][data_channel][orig][ip]" } }
      }
      if [ftp][data_channel][resp][ip] {
        mutate { merge => { "[related][ip]" => "[ftp][data_channel][resp][ip]" } }
      }

    }
  }
}