output {

  if [event][category] {
    kafka {
      codec => json
      topic_id => "ecs-%{[event][module]}-%{[event][category]}"
      bootstrap_servers => "127.0.0.1:9092"
    }

    if [event][module] == "bro" {
      elasticsearch {
          hosts => ["127.0.0.1"]
          index => "ecs-%{[event][module]}-%{[event][category]}-%{[event][dataset]}-%{+YYYY.MM.dd}"
          manage_template => false
      }
    }

    else if [event][module] == "suricata" {
      elasticsearch {
          hosts => ["127.0.0.1"]
          index => "ecs-%{[event][module]}-%{[event][category]}-%{[event][dataset]}-%{+YYYY.MM.dd}"
          manage_template => false
      }
    }

    else {
      elasticsearch {
          hosts => ["127.0.0.1"]
          index => "ecs-%{[event][module]}-%{[event][category]}-%{+YYYY.MM.dd}"
          manage_template => false
      }
    }

    #stdout { codec => rubydebug  {metadata => true} }
    #$file { path => "/tmp/logstash.json" }

  }
}
